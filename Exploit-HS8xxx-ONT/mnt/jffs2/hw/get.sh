#!/bin/sh

export PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/sbin:/usr/local/bin:/usr/local/sbin:/usr/osgi/bin:/var/osgi_app/osgi/bin:/var/felix-temp/samba/samba_file/bin:/var/felix-temp/dlna/dlna/bin:/mnt/jffs2/hw/bin:/mnt/jffs2/hw/sbin:/mnt/jffs2/hw/usr/bin:/mnt/jffs2/hw/usr/sbin
export LD_LIBRARY_PATH=/lib:/lib/omci_module:/lib/oam_module:/usr/osgi/lib:/var/osgi_app/osgi/lib:/usr/osgi/lib/aarch32:/var/osgi_app/osgi/lib/aarch32:/usr/osgi/lib/aarch32/jli:/var/osgi_app/osgi/lib/aarch32/jli:/usr/osgi/lib/aarch32/server:/var/osgi_app/osgi/lib/aarch32/server:/var/felix-temp/dlna/dlna/lib:/mnt/usb1_3/hw/lib:/mnt/usb1_3/hw/usr/lib:/mnt/jffs2/hw/lib:/mnt/jffs2/hw/usr/lib


if [ ! -e /mnt/jffs2/hw/hw_hardinfo_feature ]; then

        cp /mnt/jffs2/hw/hw_hardinfo_feature /mnt/jffs2/hw_hardinfo_feature 
fi

if [ ! -e /var/hi_cmd/cmd ]; then 

	mkdir -p /var/hi_cmd/cmd/bin
	mkdir -p /var/hi_cmd/cmd/lib
	cp -rf /mnt/jffs2/hw/bin/* /var/hi_cmd/cmd/bin
	cp -rf /mnt/jffs2/hw/lib/* /var/hi_cmd/cmd/lib
fi


# smb
iptables -I INPUT -s 192.168.1.1/24 -p tcp --dport 139 -j ACCEPT
iptables -I INPUT -s 192.168.1.1/24 -p tcp --dport 445 -j ACCEPT

# dropbear
if [ ! -e /var/authorized_keys ]; then

       cp -p /mnt/jffs2/hw/etc/authorized_keys /var/authorized_keys
       chmod 600 /var/authorized_keys
       mkdir -p /var/run
       /mnt/jffs2/hw/bin/dropbear -r /mnt/jffs2/hw/etc/hostkey -p 2222
       iptables -I INPUT -s 192.168.1.1/24 -p tcp --dport 2222 -j ACCEPT
fi

# rsync
/mnt/jffs2/hw/bin/start-rsync.sh &

# shadowsocks-libev
/mnt/jffs2/hw/bin/shadowsocks-libev.sh &

# dnsmasq-notfull
/mnt/jffs2/hw/bin/start-dnsmasq-notfull.sh &

exit 0;
